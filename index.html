<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta
      name="viewport"
      content="width=device-width,
      initial-scale=1,
      user-scalable=no"
   >
   <title>Bolsa</title>

   <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
   />

   <link rel="stylesheet" href="static/css/login.css">
   <link rel="stylesheet" href="static/css/main.css">
   <link rel="stylesheet" href="static/css/form.css">
   <link rel="stylesheet" href="static/css/panel.css">
   <link rel="stylesheet" href="static/css/table.css">
   <link rel="stylesheet" href="static/css/cells.css">

   <link rel="manifest" href="manifest.json" />

   <script src="static/js/test_data.js"></script>
   <script src="static/js/temp.js"></script>
   <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>

<main id="app"
   x-data="{
      usuario: '',
      password: '',
      logged: alvin.dev, // AAAAAAAAAAAA,
      cuenta: '',
      modo: 'main',
      changed: false,
   }"
   @logueando="logged = !logged"
>

<form id="log-form"
   x-show="!logged"
   x-transition
>
   <label for="user">User:</label>
   <input id="user" type="text" x-model="usuario">

   <label for="pass">Pass:</label>
   <input id="pass" type="password" x-model="password">

   <button @click.prevent="$dispatch('logueando')">Login</button>
</form>



<div id="main"
   x-data="{table_size: 5, registros: alvin.data}"
   x-show="logged"
   x-cloak
   x-transition
>
   <div class="arriba">
      <button id="cuenta" disabled>Cuenta</button>
      <br>
      <button id="log-out" @click="$dispatch('logueando')">Log out</button>
      <button id="import" disabled>Import</button>
      <button id="export" disabled>Export</button>
      <button id="save" disabled>Save</button>
   </div>



   <div class="tabla" :class="'level-' + table_size">
      <div class="cabecera">
         <span class="cell-1">Ix</span>
         <span class="cell-2">Fecha</span>
         <span class="cell-3">Abono</span>
         <span class="cell-4">Cargo</span>
         <span class="cell-5" x-show="table_size >= 5">Motivo</span>
         <span class="cell-6" x-show="table_size >= 6">Detalle</span>
         <span class="cell-7" x-show="table_size >= 7">Fuente</span>
      </div>
      <div class="registros">
         <template x-for="(fila, id) in registros">
         <div :id="'row-' + (id + 1)">
            <span class="cell-1" x-text="id + 1"></span>
            <span class="cell-2" x-text="fila[0]"></span>
            <span class="cell-3 positive" x-text="fila[1].toLocaleString('es-CL')"></span>
            <span class="cell-4 negative" x-text="fila[2].toLocaleString('es-CL')"></span>
            <span class="cell-5" x-text="fila[3]" x-show="table_size >= 5"></span>
            <span class="cell-6" x-text="fila[4]" x-show="table_size >= 6"></span>
            <span class="cell-7" x-text="fila[5]" x-show="table_size >= 7"></span>
            <span class="del-cell" x-show="modo == 'borrar'">
               <input
                  class="del-switch"
                  type="checkbox"
                  role="switch"
                  @click="fila[6] = !fila[6]"
                  @del-off.window="$el.checked = false"
               >
            </span>
         </div>
         </template>
      </div>
   </div>



   <article
      x-data="{ new_row: {
         fecha: null,
         abono: null,
         cargo: null,
         motivo: null,
         detalle: null,
         fuente: null
      } }"
      id="dogo"
      x-show="modo == 'addition'"
   >
      <div class="header">
         <b>add new log</b>
      </div>

      <template x-if="modo == 'addition'">
      <div class="section">
         <div>
            <span>Fecha:</span><input type="date" x-model="new_row['fecha']">
         </div>

         <div x-data="{abono: true}">
            <span
               @click="abono = !abono; new_row['abono'] = null; new_row['cargo'] = null"
               x-text="abono? 'Abono:': 'Cargo:'"
               :style="{backgroundColor, color, fontWeight} = (() => {if (abono) return {backgroundColor: 'green', color: 'white'}; else return {backgroundColor: 'red', color: 'white', fontWeight: 'bold'}})()"
            >
            </span>
            <input type="number" x-show="abono" x-model="new_row['abono']">
            <input type="number" x-show="!abono" x-model="new_row['cargo']">
         </div>

         <div>
            <span>Motivo:</span><input type="text" x-model="new_row['motivo']">
         </div>

         <div>
            <span>Detalle:</span><input type="text" x-model="new_row['detalle']">
         </div>

         <div>
            <span>Fuente:</span><input type="text" x-model="new_row['fuente']">
         </div>
      </div>
      </template>

      <div class="footer">
            <button @click="modo = 'main'">cancelar</button>
            <button @click="modo = 'main'; registros.push(get_shit(new_row)); a = registros">registrar</button>
      </div>
   </article>



   <div class="abajo">
      <div id="status">
         <div id="count" x-text="'count: x'"></div>
         <div id="sum" x-text="'sum: x'"></div>
         <div id="average" x-text="'average: x'"></div>
      </div>



      <div id="actions" :class="modo == 'borrar'? 'borrando': ''">
         <button id="del-button"
            :disabled="modo == 'addition'"
            @click="
               if (modo == 'main')
                  modo = 'borrar';
               else {
                  $dispatch('del-off');
                  registros = registros.filter((fila) => !fila[6]);
                  modo = 'main';
               }
            "
            x-text="modo == 'borrar'? `Confirmar eliminacion (${
               registros.reduce((cum, fila) => fila[6]? cum + 1: cum, 0)
            })`: 'Delete Mode'"
         >
            Delete Mode
         </button>



         <button id="new-rec-button" x-show="modo != 'borrar'"
            :disabled="modo == 'addition'"
            @click="if (modo == 'main') modo = 'addition'"
         >
            New Record
         </button>



         <button id="detail-level-button"
            @click="if (table_size >= 7) table_size = 5; else table_size++"
         >
            Detail Level
         </button>
      </div>
   </div>

</div>

</main>

</body>
</html>

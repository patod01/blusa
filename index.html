<!DOCTYPE html>
<html>
<head>
   <meta charset="utf-8">
   <meta
      name="viewport"
      content="width=device-width,
      initial-scale=1,
      user-scalable=no"
   >
   <title>Bolsa</title>

   <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css"
   />

   <link rel="stylesheet" href="static/css/main.css">
   <link rel="stylesheet" href="static/css/form.css">
   <link rel="stylesheet" href="static/css/panel.css">
   <link rel="stylesheet" href="static/css/table.css">
   <link rel="stylesheet" href="static/css/cells.css">

   <link rel="manifest" href="manifest.json" />

   <script src="static/js/test_data.js"></script>
   <script src="static/js/temp.js"></script>
   <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body>

<main id="app"
   x-data="{
      usuario: '',
      password: '',
      logged: alvin.dev, // AAAAAAAAAAAA,
      cuenta: '',
      modo: 'main',
      changed: false,
   }"
   @logueando="logged = !logged"
>

<form id="log-form"
   x-show="!logged"
   x-transition
>
   <label for="user">User:</label>
   <input type="text" id="user" x-model="usuario">
   <!-- <span x-text="usuario"></span> -->

   <label for="pass">Pass:</label>
   <input type="password" id="pass" x-model="password">
   <!-- <span x-text="password"></span> -->

   <button @click.prevent="$dispatch('logueando')">Login</button>
</form>



<div id="main"
   x-data="{table_size: 5, registros: alvin.data}"
   x-show="logged"
   x-cloak
   x-transition
>
   <div class="arriba">
      <button id="cuenta">Cuenta</button>
      <br>
      <button id="log-out" @click="$dispatch('logueando')">Log out</button>
      <button id="export">Import</button>
      <button id="export">Export</button>
      <button id="save">Save</button>
   </div>



   <div class="tabla" :class="'level-' + table_size">
      <div class="cabecera">
         <span class="cell-1">Ix</span>
         <span class="cell-2">Fecha</span>
         <span class="cell-3">Abono</span>
         <span class="cell-4">Cargo</span>
         <span class="cell-5" x-show="table_size >= 5">Motivo</span>
         <span class="cell-6" x-show="table_size >= 6">Detalle</span>
         <span class="cell-7" x-show="table_size >= 7">Fuente</span>
      </div>
      <div class="registros">
         <template x-for="(fila, id) in registros">
         <div :id="'row-' + (id + 1)">
            <span class="cell-1" x-text="id + 1"></span>
            <span class="cell-2" x-text="fila[0]"></span>
            <span class="cell-3 positive" x-text="fila[1].toLocaleString('es-CL')"></span>
            <span class="cell-4 negative" x-text="fila[2].toLocaleString('es-CL')"></span>
            <span class="cell-5" x-text="fila[3]" x-show="table_size >= 5"></span>
            <span class="cell-6" x-text="fila[4]" x-show="table_size >= 6"></span>
            <span class="cell-7" x-text="fila[5]" x-show="table_size >= 7"></span>
            <span class="del-cell" x-show="modo == 'borrar'">
               <input
                  class="del-switch"
                  type="checkbox"
                  role="switch"
                  @click="fila[6] = !fila[6]"
                  @del-off.window="$el.checked = false"
               >
            </span>
         </div>
         </template>
      </div>
   </div>



   <div class="abajo">
      <div id="status">
         <div id="count" x-text="'count: x'"></div>
         <div id="sum" x-text="'sum: x'"></div>
         <div id="average" x-text="'average: x'"></div>
      </div>
      <div id="actions" :class="modo == 'borrar'? 'borrando': ''">

         <button id="del-button"
            @click="
               if (modo == 'main')
                  modo = 'borrar';
               else {
                  $dispatch('del-off');
                  registros = registros.filter((fila) => !fila[6]);
                  modo = 'main';
               }
            "
            x-text="modo == 'borrar'? `Confirmar eliminacion (${
               registros.reduce((cum, fila) => fila[6]? cum + 1: cum, 0)
            })`: 'Delete Mode'"
         >
            Delete Mode
         </button>



         <button id="new-rec-button" x-show="modo != 'borrar'"
            @click=""
         >
            New Record
         </button>



         <button id="detail-level-button"
            @click="if (table_size >= 7) table_size = 5; else table_size++"
         >
            Detail Level
         </button>

      </div>
   </div>
</div>

</main>

</body>
</html>
